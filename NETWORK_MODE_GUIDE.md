# WebP视频传输系统 - 网络模式指南

## 📋 概述

WebP视频传输系统现在支持两种传输模式：
- **有线UART模式**: 300,000 bps 串口传输
- **网络模式**: 模拟1MHz UART速率的网络传输

网络模式保持与有线模式完全一致的视频压缩、传输协议和性能参数，同时支持通过网络在不同电脑之间进行视频串流。

## 🚀 快速开始

### 1. 启动发送端
```bash
python webp_sender.py
```
- 选择传输模式: `2` (网络传输)
- 程序将启动网络服务器，等待接收端连接
- 显示: `🌐 网络服务器已启动，等待连接...`

### 2. 启动接收端  
```bash
python webp_receiver.py
```
- 选择传输模式: `2` (网络传输)
- 程序将连接到发送端，开始接收视频流
- 显示: `✅ 已连接到发送端: 127.0.0.1:8888`

## 🔧 配置选项

### 网络配置
在 `webp_sender.py` 和 `webp_receiver.py` 中修改以下变量:

```python
# 网络配置 (网络模式)
NETWORK_HOST = '127.0.0.1'  # 服务器IP
NETWORK_PORT = 8888         # 网络端口
```

### 性能配置
网络模式支持所有有线模式的性能选项:

```bash
# 启动不同性能模式
python webp_sender.py balanced       # 平衡模式 (默认)
python webp_sender.py high_fps       # 高帧率模式
python webp_sender.py high_quality   # 高画质模式
python webp_sender.py ultra_fast     # 极速模式
```

## 📊 技术特性

### UART速率模拟
- **网络速率**: 1MHz (1,000,000 bps)
- **每秒字节数**: 125,000 bytes/sec
- **智能速率控制**: 自动限制传输速度匹配UART性能

### 传输协议
网络模式使用与UART模式完全相同的协议:
```
数据包结构: 魔数(4) + 帧ID(4) + 长度(4) + 类型(8) + 哈希(4) + 数据
- 魔数: b'WEBP'
- 完整性校验: MD5哈希验证
- 错误恢复: 自动重传机制
```

### 性能对比
| 模式 | 速率 | 每秒包数(1KB) | 每秒包数(2KB) | 适用场景 |
|------|------|---------------|---------------|----------|
| UART | 300K bps | 37.5 | 18.8 | 有线连接 |
| 网络 | 1M bps | 125 | 62.5 | 无线/远程 |

## 🌐 双电脑配置

### 电脑A (发送端)
1. 获取IP地址: `ipconfig` (Windows) 或 `ifconfig` (Linux/Mac)
2. 修改 `webp_sender.py`:
   ```python
   NETWORK_HOST = '0.0.0.0'  # 监听所有接口
   ```
3. 确保防火墙允许端口8888通信

### 电脑B (接收端)
1. 修改 `webp_receiver.py`:
   ```python
   NETWORK_HOST = '192.168.1.100'  # 电脑A的实际IP
   ```
2. 启动接收端程序

### 防火墙配置
**Windows:**
```cmd
netsh advfirewall firewall add rule name="WebP Video" dir=in action=allow protocol=TCP localport=8888
```

**Linux:**
```bash
sudo ufw allow 8888/tcp
```

## 🛠️ 故障排除

### 常见问题

**1. 连接被拒绝**
```
❌ 网络连接失败: [Errno 10061] No connection could be made
```
- 检查发送端是否已启动
- 确认IP地址和端口配置正确
- 检查防火墙设置

**2. 连接超时**
```
❌ 网络连接失败: timed out
```
- 确认两台电脑在同一网络
- 检查网络连通性: `ping <IP地址>`
- 确认防火墙允许通信

**3. 传输中断**
```
⚠️ 网络接收中断: 还需XXX字节
```
- 网络不稳定，程序会自动重试
- 检查网络连接质量
- 考虑降低性能模式

### 调试工具

**测试网络连接:**
```bash
python test_network_mode.py test
```

**检查端口占用:**
```bash
# Windows
netstat -an | findstr 8888

# Linux/Mac  
netstat -an | grep 8888
```

## 📈 性能监控

### 实时统计
程序运行时显示:
- **压缩比**: 数据压缩效率
- **帧率**: 实际传输帧率  
- **包大小**: 平均数据包大小
- **成功率**: 传输成功百分比
- **网络状态**: 连接状态监控

### 优化建议
1. **网络环境**: 使用有线网络获得最佳性能
2. **性能模式**: 根据网络条件选择合适模式
3. **防火墙**: 添加程序例外提高稳定性
4. **资源监控**: 监控CPU和内存使用情况

## 🔄 与UART模式对比

| 特性 | UART模式 | 网络模式 |
|------|----------|----------|
| 连接方式 | 串口线缆 | 网络连接 |
| 传输速率 | 300K bps | 1M bps (模拟) |
| 连接范围 | 本地设备 | 网络范围 |
| 稳定性 | 极高 | 取决于网络 |
| 配置复杂度 | 简单 | 中等 |
| 扩展性 | 有限 | 灵活 |

## 📞 技术支持

如有问题或建议，请查看:
- 日志输出中的错误信息
- 网络连接状态
- 防火墙配置
- IP地址配置

---

*最后更新: 2024年* 